{% extends 'base.html.twig' %}

{% form_theme form 'demande/demande_custom_theme.html.twig'%}

{% block title %}{% endblock %}

{% block body_id %}{% endblock %}

{% block class %}body-ccm{% endblock %}
{% block stylesheets %}
    {{ parent()}}
    <style>
        .tooltip-inner {
            min-width: 100px;
            max-width: 50%;
        }
    </style>
    <link rel="stylesheet" href="{{ asset('asset/libs/css/jquery.steps.css') }}">
    <link rel="stylesheet" href="{{ asset('asset/libs/css/normalize.css') }}">
    <link rel="stylesheet" href="{{ asset('asset/libs/css/main.css') }}">
{% endblock %}


{% block page_content %}
<div class="col-sm-10 col-lg-12 d-flex flex-row justify-content-center my-flex-container align-items-center mobile-center">
        <div class="col-12 commander-firstview mt-4 custom-form">
            <h2 class="col-md-10 mx-auto full-mobile"> {{ commande.demarche.nom|upper }}</h2>
                {{ form_start(form, {'attr': {'id': 'example-advanced-form'}}) }}
                    <h3>Etape</h3>
                    <fieldset>
                        <legend>{{ form_label(form.duplicata.titulaire)}}</legend>

                        {# <label for="userName-2">User name *</label>
                        <input id="userName-2" name="userName" type="text" class="required">
                        <label for="password-2">Password *</label>
                        <input id="password-2" name="password" type="text" class="required">
                        <label for="confirm-2">Confirm Password *</label>
                        <input id="confirm-2" name="confirm" type="text" class="required">
                        <p>(*) Mandatory</p> #}
                            <div class="form-titulaire">
                                {{ form_row(form.duplicata.titulaire.type)}}
                                {{ form_row(form.duplicata.titulaire.raisonsociale, {'attr': {'data-row-style': 'display:none !important;'} })}}
                                {{ form_row(form.duplicata.titulaire.nomprenom)}}
                            </div>

                            <div class="motifDemande">
                                {{ form_row(form.duplicata.motifDemande)}}
                                {{ form_row(form.duplicata.datePerte)}}
                            </div>
                    </fieldset>

                    <h3>Etape</h3>
                    <fieldset>
                        <legend>Profile Information</legend>

                        {# <label for="name-2">First name *</label>
                        <input id="name-2" name="name" type="text" class="required">
                        <label for="surname-2">Last name *</label>
                        <input id="surname-2" name="surname" type="text" class="required">
                        <label for="email-2">Email *</label>
                        <input id="email-2" name="email" type="text" class="required email">
                        <label for="address-2">Address</label>
                        <input id="address-2" name="address" type="text">
                        <label for="age-2">Age (The warning step will show up if age is less than 18) *</label>
                        <input id="age-2" name="age" type="text" class="required number">
                        <p>(*) Mandatory</p> #}
                        <div class="col-12">
                            {{ form_label(form.duplicata.numeroFormule)}}
                            <span type="button" class="fa fa-question-circle" data-html="true" data-toggle="tooltip" data-placement="top"
                                template='{% include "demande/tooltips/templateCessionNumFormulCarteGrise.html.twig" %}'
                                title="{% include 'demande/tooltips/cessionNumFormulCarteGrise.html.twig' %}">
                            </span>
                            {{ form_errors(form.duplicata.numeroFormule)}}
                            {{ form_widget(form.duplicata.numeroFormule)}}
                            <br>
                        </div>  
                    </fieldset>

                    <h3>Etape</h3>
                    <fieldset>
                        <legend>You are to young</legend>

                        <p>Please go away ;-)</p>

                        {{ form_rest(form) }}
                        <div class="col-12 text-center mb-5">
                            <br>
                            <input type="submit" class="btn btn-lg btn-success" value="Valider">
                        </div>
                    </fieldset>

                    <h3>Etape</h3>
                    <fieldset>
                        <legend>Terms and Conditions</legend>

                        <input id="acceptTerms-2" name="acceptTerms" type="checkbox" class="required"> <label for="acceptTerms-2">I agree with the Terms and Conditions.</label>
                    </fieldset>
                {{ form_end(form) }}
        </div>
</div>
{% endblock %}

{% block javascripts %}
{{ parent() }}
<script src="{{asset('javascripts/jQuerySteps/jquery.validate.js') }}"></script>
<script src="{{asset('javascripts/jQuerySteps/jquery.steps.js') }}"></script>
<script type="application/javascript">
    $('.choice-type-ancientitulaire').on('change', function(e) {
        $(e.target).parent().siblings().toggle();
    });
    $(function () {
        $('[data-toggle="tooltip"]').tooltip();
    })
    $('#demande_duplicata_duplicata_motifDemande').on('change', function (e) {
        var Value = $(".motifDemande").find(":selected").text();
        if (Value === "Perte") {
            $(e.target).parent().siblings().show();
        } else {
            $(e.target).parent().siblings().hide();
        }
    });
</script>
<script type="text/javascript">
    $('.js-datepicker').datepicker({
        dateFormat: 'dd/mm/yy',
        changeMonth: true,
        changeYear: true
    });
</script>
<script>
        var form = $("#example-advanced-form").show();
        
        form.steps({
            headerTag: "h3",
            bodyTag: "fieldset",
            transitionEffect: "slideLeft",
            onStepChanging: function (event, currentIndex, newIndex)
            {
                // Allways allow previous action even if the current form is not valid!
                if (currentIndex > newIndex)
                {
                    return true;
                }
                // Forbid next action on "Warning" step if the user is to young
                if (newIndex === 3 && Number($("#age-2").val()) < 18)
                {
                    return false;
                }
                // Needed in some cases if the user went back (clean up)
                if (currentIndex < newIndex)
                {
                    // To remove error styles
                    form.find(".body:eq(" + newIndex + ") label.error").remove();
                    form.find(".body:eq(" + newIndex + ") .error").removeClass("error");
                }
                form.validate().settings.ignore = ":disabled,:hidden";
                return form.valid();
            },
            onStepChanged: function (event, currentIndex, priorIndex)
            {
                // Used to skip the "Warning" step if the user is old enough.
                if (currentIndex === 2 && Number($("#age-2").val()) >= 18)
                {
                    form.steps("next");
                }
                // Used to skip the "Warning" step if the user is old enough and wants to the previous step.
                if (currentIndex === 2 && priorIndex === 3)
                {
                    form.steps("previous");
                }
            },
            onFinishing: function (event, currentIndex)
            {
                form.validate().settings.ignore = ":disabled";
                return form.valid();
            },
            onFinished: function (event, currentIndex)
            {
                alert("Submitted!");
            }
        }).validate({
            errorPlacement: function errorPlacement(error, element) { element.before(error); },
            rules: {
                confirm: {
                    equalTo: "#password-2"
                }
            }
        });
</script>
{% endblock %}